<view class="page data-v-d90dac46"><view class="custom-navbar data-v-d90dac46" style="{{'padding-top:'+(statusBarHeight+'px')+';'}}"><view class="navbar-content data-v-d90dac46"><view data-event-opts="{{[['tap',[['goBack',['$event']]]]]}}" class="navbar-left data-v-d90dac46" bindtap="__e"><text class="back-icon data-v-d90dac46">←</text></view><view class="navbar-title data-v-d90dac46">发布任务</view><view class="navbar-right data-v-d90dac46"></view></view></view><scroll-view class="content-scroll data-v-d90dac46" scroll-y="{{true}}"><view class="steps data-v-d90dac46"><view class="{{['step','data-v-d90dac46',(currentStep>=1)?'active':'']}}"><view class="step-number data-v-d90dac46">1</view><text class="step-text data-v-d90dac46">项目需求</text></view><view class="{{['step-line','data-v-d90dac46',(currentStep>=2)?'active':'']}}"></view><view class="{{['step','data-v-d90dac46',(currentStep>=2)?'active':'']}}"><view class="step-number data-v-d90dac46">2</view><text class="step-text data-v-d90dac46">资金托管</text></view><view class="{{['step-line','data-v-d90dac46',(currentStep>=3)?'active':'']}}"></view><view class="{{['step','data-v-d90dac46',(currentStep>=3)?'active':'']}}"><view class="step-number data-v-d90dac46">3</view><text class="step-text data-v-d90dac46">确认发布</text></view></view><block wx:if="{{currentStep===1}}"><view class="step-content data-v-d90dac46"><view class="section data-v-d90dac46"><view class="section-title data-v-d90dac46">项目基本信息</view><view class="form-item data-v-d90dac46"><view class="form-label required data-v-d90dac46">项目名称</view><input class="form-input data-v-d90dac46" placeholder="例如：跨境支付系统前端开发" placeholder-class="placeholder" data-event-opts="{{[['input',[['__set_model',['$0','title','$event',[]],['formData']]]]]}}" value="{{formData.title}}" bindinput="__e"/></view><view class="form-item data-v-d90dac46"><view class="form-label required data-v-d90dac46">项目分类</view><picker mode="multiSelector" range="{{categoryColumns}}" range-key="name" value="{{categoryIndexes}}" data-event-opts="{{[['change',[['onCategoryChange',['$event']]]],['columnchange',[['onCategoryColumnChange',['$event']]]]]}}" bindchange="__e" bindcolumnchange="__e" class="data-v-d90dac46"><view class="{{['form-picker','data-v-d90dac46',(!formData.categoryName)?'placeholder':'']}}">{{''+(formData.categoryName||'请选择项目分类')+''}}</view></picker><view class="form-tip data-v-d90dac46">三列分别选择：一级分类、二级分类、三级分类</view></view><view class="form-item data-v-d90dac46"><view class="form-label data-v-d90dac46">技术要求</view><input class="form-input data-v-d90dac46" placeholder="例如：Vue3, TypeScript, Node.js" placeholder-class="placeholder" data-event-opts="{{[['input',[['__set_model',['$0','techStack','$event',[]],['formData']]]]]}}" value="{{formData.techStack}}" bindinput="__e"/></view><view class="form-item data-v-d90dac46"><view class="form-label required data-v-d90dac46">需求简述</view><textarea class="form-textarea data-v-d90dac46" placeholder="简要描述项目背景和核心需求..." placeholder-class="placeholder" maxlength="{{500}}" data-event-opts="{{[['input',[['__set_model',['$0','description','$event',[]],['formData']]]]]}}" value="{{formData.description}}" bindinput="__e"></textarea><view class="char-count data-v-d90dac46">{{$root.g0+"/500"}}</view></view><view class="form-item data-v-d90dac46"><view class="form-label data-v-d90dac46">详细需求</view><textarea class="form-textarea large data-v-d90dac46" placeholder="详细描述功能模块、交付标准等...&#10;&#10;例如：&#10;1. 用户登录注册模块&#10;2. 商品列表展示&#10;3. 购物车功能" placeholder-class="placeholder" maxlength="{{2000}}" data-event-opts="{{[['input',[['__set_model',['$0','features','$event',[]],['formData']]]]]}}" value="{{formData.features}}" bindinput="__e"></textarea><view class="char-count data-v-d90dac46">{{$root.g1+"/2000"}}</view></view><view class="form-item data-v-d90dac46"><view class="form-label data-v-d90dac46">开发文档</view><view class="upload-list data-v-d90dac46"><block wx:for="{{$root.l0}}" wx:for-item="file" wx:for-index="index" wx:key="index"><view class="upload-item data-v-d90dac46"><block wx:if="{{file.m0}}"><image class="upload-preview data-v-d90dac46" src="{{file.$orig.url}}" mode="aspectFill"></image></block><block wx:else><view class="upload-file data-v-d90dac46"><text class="iconfont icon-file data-v-d90dac46"></text><text class="file-name data-v-d90dac46">{{file.$orig.name}}</text></view></block><view data-event-opts="{{[['tap',[['removeFile',[index]]]]]}}" class="upload-delete data-v-d90dac46" bindtap="__e"><text class="iconfont icon-close data-v-d90dac46"></text></view></view></block><block wx:if="{{$root.g2<9}}"><view data-event-opts="{{[['tap',[['chooseFile',['$event']]]]]}}" class="upload-btn data-v-d90dac46" bindtap="__e"><text class="iconfont icon-plus data-v-d90dac46"></text><text class="upload-text data-v-d90dac46">上传文件</text></view></block></view><view class="form-tip data-v-d90dac46">支持图片、PDF、Word等，最多9个文件</view></view><view class="form-row data-v-d90dac46"><view class="form-item half data-v-d90dac46"><view class="form-label required data-v-d90dac46">开始时间</view><picker mode="date" value="{{formData.startTime}}" data-event-opts="{{[['change',[['onStartTimeChange',['$event']]]]]}}" bindchange="__e" class="data-v-d90dac46"><view class="{{['form-picker','data-v-d90dac46',(!formData.startTime)?'placeholder':'']}}">{{''+(formData.startTime||'选择日期')+''}}</view></picker></view><view class="form-item half data-v-d90dac46"><view class="form-label required data-v-d90dac46">交付日期</view><picker mode="date" value="{{formData.deliveryTime}}" data-event-opts="{{[['change',[['onDeliveryTimeChange',['$event']]]]]}}" bindchange="__e" class="data-v-d90dac46"><view class="{{['form-picker','data-v-d90dac46',(!formData.deliveryTime)?'placeholder':'']}}">{{''+(formData.deliveryTime||'选择日期')+''}}</view></picker></view></view></view><view class="btn-group data-v-d90dac46"><button data-event-opts="{{[['tap',[['nextStep',['$event']]]]]}}" class="btn btn-primary data-v-d90dac46" bindtap="__e">下一步</button></view></view></block><block wx:if="{{currentStep===2}}"><view class="step-content data-v-d90dac46"><view class="section data-v-d90dac46"><view class="section-title data-v-d90dac46">选择付款方案</view><view class="plan-list data-v-d90dac46"><block wx:for="{{paymentPlans}}" wx:for-item="plan" wx:for-index="__i0__" wx:key="id"><view data-event-opts="{{[['tap',[['selectPlan',['$0'],[[['paymentPlans','id',plan.id]]]]]]]}}" class="{{['plan-card','data-v-d90dac46',(selectedPlanId===plan.id)?'active':'']}}" bindtap="__e"><view class="plan-header data-v-d90dac46"><text class="plan-name data-v-d90dac46">{{plan.name}}</text><block wx:if="{{selectedPlanId===plan.id}}"><view class="plan-check data-v-d90dac46"><text class="iconfont icon-check data-v-d90dac46"></text></view></block></view><view class="plan-desc data-v-d90dac46">{{plan.desc}}</view></view></block></view></view><view class="section data-v-d90dac46"><view class="section-title data-v-d90dac46">项目总预算</view><view class="budget-input data-v-d90dac46"><text class="budget-symbol data-v-d90dac46">¥</text><input class="budget-value data-v-d90dac46" type="digit" placeholder="请输入金额" data-event-opts="{{[['input',[['__set_model',['','totalBudget','$event',[]]],['onBudgetChange',['$event']]]]]}}" value="{{totalBudget}}" bindinput="__e"/></view><view class="form-tip data-v-d90dac46">最低100元，平台将收取5%服务费</view></view><view class="section data-v-d90dac46"><view class="section-title data-v-d90dac46">付款阶段</view><view class="stage-list data-v-d90dac46"><block wx:for="{{$root.l1}}" wx:for-item="stage" wx:for-index="index" wx:key="index"><view class="stage-card data-v-d90dac46"><view class="stage-header data-v-d90dac46"><view class="stage-number data-v-d90dac46" style="{{'background:'+(stage.m1)+';'}}">{{''+(index+1)+''}}</view><input class="stage-name data-v-d90dac46" placeholder="阶段名称" data-event-opts="{{[['input',[['__set_model',['$0','name','$event',[]],[[['formData.stages','',index]]]]]]]}}" value="{{stage.$orig.name}}" bindinput="__e"/><block wx:if="{{stage.g3>2}}"><view data-event-opts="{{[['tap',[['removeStage',[index]]]]]}}" class="stage-delete data-v-d90dac46" bindtap="__e"><text class="iconfont icon-delete data-v-d90dac46"></text></view></block></view><view class="stage-amount data-v-d90dac46"><view class="amount-input data-v-d90dac46"><input type="digit" data-event-opts="{{[['input',[['__set_model',['$0','percent','$event',[]],[[['formData.stages','',index]]]],['updateStageAmount',[index]]]]]}}" value="{{stage.$orig.percent}}" bindinput="__e" class="data-v-d90dac46"/><text class="data-v-d90dac46">%</text></view><text class="amount-value data-v-d90dac46">{{"¥"+stage.g4}}</text></view><view class="stage-field data-v-d90dac46"><text class="field-label data-v-d90dac46">付款节点</text><input class="field-input data-v-d90dac46" placeholder="如：合同签订当日" data-event-opts="{{[['input',[['__set_model',['$0','milestone','$event',[]],[[['formData.stages','',index]]]]]]]}}" value="{{stage.$orig.milestone}}" bindinput="__e"/></view><view class="stage-field data-v-d90dac46"><text class="field-label data-v-d90dac46">风险说明</text><textarea class="field-textarea data-v-d90dac46" placeholder="如：客户跑路可覆盖30%人力成本" maxlength="{{200}}" data-event-opts="{{[['input',[['__set_model',['$0','riskNote','$event',[]],[[['formData.stages','',index]]]]]]]}}" value="{{stage.$orig.riskNote}}" bindinput="__e"></textarea></view></view></block></view><block wx:if="{{$root.g5<5}}"><view data-event-opts="{{[['tap',[['addStage',['$event']]]]]}}" class="add-stage-btn data-v-d90dac46" bindtap="__e"><text class="iconfont icon-plus data-v-d90dac46"></text><text class="data-v-d90dac46">添加结算节点</text></view></block><block wx:if="{{totalPercent!==100}}"><view class="percent-warning data-v-d90dac46"><text class="iconfont icon-warning data-v-d90dac46"></text><text class="data-v-d90dac46">{{"当前比例合计 "+totalPercent+"%，需等于 100%"}}</text></view></block></view><view class="info-box data-v-d90dac46"><view class="info-title data-v-d90dac46"><text class="iconfont icon-info data-v-d90dac46"></text><text class="data-v-d90dac46">分期付款方案说明</text></view><view class="info-item data-v-d90dac46">• 352方案：30%定金 + 50%中期款 + 20%尾款</view><view class="info-item data-v-d90dac46">• 37方案：30%定金 + 70%尾款（无质保）</view><view class="info-item data-v-d90dac46">• 442方案：40%定金 + 40%中期款 + 20%尾款</view></view><view class="btn-group data-v-d90dac46"><button data-event-opts="{{[['tap',[['prevStep',['$event']]]]]}}" class="btn btn-default data-v-d90dac46" bindtap="__e">上一步</button><button data-event-opts="{{[['tap',[['nextStep',['$event']]]]]}}" class="btn btn-primary data-v-d90dac46" bindtap="__e">下一步</button></view></view></block><block wx:if="{{currentStep===3}}"><view class="step-content data-v-d90dac46"><view class="section data-v-d90dac46"><view class="section-title data-v-d90dac46">项目信息</view><view class="confirm-item data-v-d90dac46"><text class="confirm-label data-v-d90dac46">项目名称</text><text class="confirm-value data-v-d90dac46">{{formData.title}}</text></view><view class="confirm-item data-v-d90dac46"><text class="confirm-label data-v-d90dac46">项目分类</text><text class="confirm-value data-v-d90dac46">{{formData.categoryName}}</text></view><view class="confirm-item data-v-d90dac46"><text class="confirm-label data-v-d90dac46">技术要求</text><text class="confirm-value data-v-d90dac46">{{formData.techStack||'无'}}</text></view><view class="confirm-item data-v-d90dac46"><text class="confirm-label data-v-d90dac46">项目周期</text><text class="confirm-value data-v-d90dac46">{{formData.startTime+" 至 "+formData.deliveryTime}}</text></view></view><view class="section data-v-d90dac46"><view class="section-title data-v-d90dac46">资金托管</view><view class="confirm-budget data-v-d90dac46"><text class="budget-label data-v-d90dac46">托管总金额</text><text class="budget-amount data-v-d90dac46">{{"¥"+$root.g6}}</text></view><view class="stage-summary data-v-d90dac46"><block wx:for="{{$root.l2}}" wx:for-item="stage" wx:for-index="index" wx:key="index"><view class="summary-item data-v-d90dac46"><view class="summary-dot data-v-d90dac46" style="{{'background:'+(stage.m2)+';'}}"></view><text class="summary-name data-v-d90dac46">{{stage.$orig.name}}</text><text class="summary-percent data-v-d90dac46">{{stage.$orig.percent+"%"}}</text><text class="summary-amount data-v-d90dac46">{{"¥"+stage.g7}}</text></view></block></view></view><view class="warning-box data-v-d90dac46"><text class="iconfont icon-shield data-v-d90dac46"></text><text class="warning-text data-v-d90dac46">任务发布后等待商家接单。商家接单后，您需要进行资金托管，订单才正式开始执行。</text></view><view class="btn-group data-v-d90dac46"><button data-event-opts="{{[['tap',[['prevStep',['$event']]]]]}}" class="btn btn-default data-v-d90dac46" bindtap="__e">上一步</button><button class="btn btn-primary data-v-d90dac46" loading="{{submitting}}" data-event-opts="{{[['tap',[['handleSubmit',['$event']]]]]}}" bindtap="__e">{{''+(submitting?'发布中...':'确认发布')+''}}</button></view></view></block><view style="height:40rpx;" class="data-v-d90dac46"></view></scroll-view></view>