{"version":3,"sources":["uni-app:///main.js","webpack:///R:/Code_Repository/TrustFulfillment/fronted_uniapp/pages/order/detail.vue?f593","webpack:///R:/Code_Repository/TrustFulfillment/fronted_uniapp/pages/order/detail.vue?1380","webpack:///R:/Code_Repository/TrustFulfillment/fronted_uniapp/pages/order/detail.vue?d527","webpack:///R:/Code_Repository/TrustFulfillment/fronted_uniapp/pages/order/detail.vue?a95a","uni-app:///pages/order/detail.vue","webpack:///R:/Code_Repository/TrustFulfillment/fronted_uniapp/pages/order/detail.vue?ac7b","webpack:///R:/Code_Repository/TrustFulfillment/fronted_uniapp/pages/order/detail.vue?6e85"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","order","id","orderNo","status","statusText","title","amount","timeline","mounted","onShow","methods","loadOrderDetail","url","method","res","role","console","uni","icon","getUserRole","buildTimeline","list","desc","done","active","actions","orderId","contractId","stageId","getStageActions","getStatusText","formatCurrency","minimumFractionDigits","maximumFractionDigits","formatDate","goBack","handleAction","action","content","confirmText","success","contractRes","signature","setTimeout","showCancel","editable","placeholderText","evidenceUrl","deliveryDesc","reason"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,eAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAA+H;AAC/H;AAC0D;AACL;AACsC;;;AAG3F;AACqK;AACrK,gBAAgB,+KAAU;AAC1B,EAAE,4EAAM;AACR,EAAE,6FAAM;AACR,EAAE,sGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,iGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAgmB,CAAgB,0nBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;ACsCpnB;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eAEA;EACAC;IACA;MACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACAC;IACA;EACA;EACAC;IACA;IACA;IACA;IACA;MACA;MACA;IACA;EACA;EACAC;IACA;IACA;MACA;IACA;EACA;EACAC;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA;gBAAA,OAEA;kBACAC;kBACAC;gBACA;cAAA;gBAHAC;gBAIA;kBACAf;kBACA;oBACAE;oBACAC;oBACAC;oBACAC;oBACAC;oBACAC;oBACAS;kBACA;kBAEA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAC;gBACAC;kBAAAZ;kBAAAa;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IACAC;MACA;MACA;MACA;MACA;IACA;IACAC;MAAA;MACA;MACA;;MAEA;MACAC;QACAhB;QACAiB;QACAC;QACAC;MACA;;MAEA;MACA;QAAA;QACAH;UACAhB;UACAiB;UACAC;UACAC;QACA;MACA;;MAEA;MACA;QACA;QACA;QAEA;UACA;UACAH;YACAhB;YACAiB;YACAC;YACAC;YACAC;YACAC;UACA;QACA;UACA;UACA;UACA;;UAEA;YACAL;cACAhB;cACAiB;cACAC;cACAC;cACAC;cACAC;cACAC;YACA;UACA;YACAN;cACAhB;cACAiB;cACAC;cACAC;cACAC;cACAC;cACAC;YACA;UACA;YACAN;cACAhB;cACAiB;cACAC;cACAC;YACA;UACA;YACAH;cACAhB;cACAiB;cACAC;cACAC;YACA;UACA;QACA;UACA;UACAH;YACAhB;YACAiB;YACAC;YACAC;UACA;QACA;MACA;;MAEA;MACA;QACAzB;UACAsB;YACAhB;YACAiB;YACAC;YAAA;YACAC;YAAA;YACAC;YACAG;YACAF;UACA;QACA;MACA;;MAEA;MACA;QAAA;QACAL;UACAhB;UACAiB;UACAC;UACAC;QACA;MACA;MAEA;IACA;IACAK;MACA;MACA;MACA;QAAA;QACA;MACA;MACA;QACA;QACA;MACA;MACA;IACA;IACAC;MACA;QACA;QAAA;QAAA;QACA;QAAA;QAAA;QACA;QAAA;QAAA;MACA;MACA;IACA;IACAC;MACA;MACA;QAAAC;QAAAC;MAAA;IACA;IACAC;MACA;MACA;IACA;IACAC;MACAlB;IACA;IACAmB;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACAV;gBAAA,MAEAW;kBAAA;kBAAA;gBAAA;gBACA;gBACApB;kBACAL;gBACA;gBAAA;cAAA;gBAAA,MAIAyB;kBAAA;kBAAA;gBAAA;gBACA;gBACAV;gBAAA,IACAA;kBAAA;kBAAA;gBAAA;gBACAV;kBAAAZ;kBAAAa;gBAAA;gBAAA;cAAA;gBAGAD;kBACAL;gBACA;gBAAA;cAAA;gBAAA,MAIAyB;kBAAA;kBAAA;gBAAA;gBACApB;kBACAZ;kBACAiC;kBACAC;kBACAC;oBAAA;sBAAA;sBAAA;wBAAA;0BAAA;4BAAA;8BAAA,KACA1B;gCAAA;gCAAA;8BAAA;8BACAG;gCAAAZ;8BAAA;8BAAA;8BAAA;8BAAA,OAGA;gCACAO;gCACAC;8BACA;4BAAA;8BAHA4B;8BAAA,MAKA;gCAAA;gCAAA;8BAAA;8BAAA,MACA;4BAAA;8BAGAd,mCAEA;8BAAA;8BAAA,OACA;gCACAf;gCACAC;gCACAd;kCACA2C;gCACA;8BACA;4BAAA;8BAEAzB;8BACAA;gCAAAZ;gCAAAa;8BAAA;;8BAEA;8BACAyB;gCACA;8BACA;8BAAA;8BAAA;4BAAA;8BAAA;8BAAA;8BAEA1B;8BACAA;gCACAZ;gCACAiC;gCACAM;8BACA;4BAAA;4BAAA;8BAAA;0BAAA;wBAAA;sBAAA;oBAAA,CAGA;oBAAA;sBAAA;oBAAA;oBAAA;kBAAA;gBACA;gBAAA;cAAA;gBAAA,MAIA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBAEAhB;gBAEA;kBACAX;oBACAZ;oBACAiC;oBACAO;oBACAC;oBACAN;sBAAA;wBAAA;0BAAA;4BAAA;8BAAA;gCAAA,KACA1B;kCAAA;kCAAA;gCAAA;gCAAA;gCAAA;gCAAA,OAEA;kCACAF;kCACAC;kCACAd;oCACAgD;oCACAC;kCACA;gCACA;8BAAA;gCACA/B;kCAAAZ;gCAAA;gCACA;gCAAA;gCAAA;8BAAA;gCAAA;gCAAA;gCAEAY;kCAAAZ;kCAAAa;gCAAA;8BAAA;8BAAA;gCAAA;4BAAA;0BAAA;wBAAA;sBAAA,CAGA;sBAAA;wBAAA;sBAAA;sBAAA;oBAAA;kBACA;gBACA;kBACAD;oBACAZ;oBACAiC;oBACAE;sBAAA;wBAAA;0BAAA;4BAAA;8BAAA;gCAAA,KACA1B;kCAAA;kCAAA;gCAAA;gCAAA;gCAAA;gCAAA,OAEA;kCACAF;kCACAC;gCACA;8BAAA;gCACAI;kCAAAZ;gCAAA;gCACA;gCAAA;gCAAA;8BAAA;gCAAA;gCAAA;gCAEAY;kCAAAZ;kCAAAa;gCAAA;8BAAA;8BAAA;gCAAA;4BAAA;0BAAA;wBAAA;sBAAA,CAGA;sBAAA;wBAAA;sBAAA;sBAAA;oBAAA;kBACA;gBACA;kBACAD;oBACAZ;oBACAiC;oBACAO;oBACAC;oBACAN;sBAAA;wBAAA;0BAAA;4BAAA;8BAAA;gCAAA,KACA1B;kCAAA;kCAAA;gCAAA;gCAAA;gCAAA;gCAAA,OAEA;kCACAF;kCACAC;kCACAd;oCAAAkD;kCAAA;gCACA;8BAAA;gCACAhC;kCAAAZ;gCAAA;gCACA;gCAAA;gCAAA;8BAAA;gCAAA;gCAAA;gCAEAY;kCAAAZ;kCAAAa;gCAAA;8BAAA;8BAAA;gCAAA;4BAAA;0BAAA;wBAAA;sBAAA,CAGA;sBAAA;wBAAA;sBAAA;sBAAA;oBAAA;kBACA;gBACA;kBACAD;oBAAAZ;oBAAAa;kBAAA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;AC9YA;AAAA;AAAA;AAAA;AAAmqC,CAAgB,yoCAAG,EAAC,C;;;;;;;;;;;ACAvrC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/order/detail.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/order/detail.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./detail.vue?vue&type=template&id=57d42baa&scoped=true&\"\nvar renderjs\nimport script from \"./detail.vue?vue&type=script&lang=js&\"\nexport * from \"./detail.vue?vue&type=script&lang=js&\"\nimport style0 from \"./detail.vue?vue&type=style&index=0&id=57d42baa&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"57d42baa\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/order/detail.vue\"\nexport default component.exports","export * from \"-!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--17-0!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./detail.vue?vue&type=template&id=57d42baa&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./detail.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./detail.vue?vue&type=script&lang=js&\"","<template>\r\n  <view class=\"page\">\r\n\r\n    <!-- 订单状态卡片 -->\r\n    <view class=\"status-card\">\r\n      <view class=\"status-header\">\r\n        <text class=\"status-badge\">{{ order.statusText }}</text>\r\n        <text class=\"order-no\">ID: {{ order.orderNo }}</text>\r\n      </view>\r\n      \r\n      <!-- 时间线 -->\r\n      <view class=\"timeline\">\r\n        <view class=\"timeline-line\"></view>\r\n        \r\n        <view class=\"timeline-item\" v-for=\"(step, index) in timeline\" :key=\"index\">\r\n          <view class=\"timeline-dot\" :class=\"{ active: step.active, done: step.done }\"></view>\r\n          <view class=\"timeline-content\">\r\n            <text class=\"timeline-title\" :class=\"{ active: step.active }\">{{ step.title }}</text>\r\n            <text class=\"timeline-desc\" v-if=\"step.desc\">{{ step.desc }}</text>\r\n            <view class=\"timeline-actions\" v-if=\"step.actions\">\r\n              <view class=\"action-btn primary\" v-for=\"action in step.actions\" :key=\"action\" @click=\"handleAction(action, step)\">\r\n                {{ action }}\r\n              </view>\r\n            </view>\r\n          </view>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 安全提醒 -->\r\n    <view class=\"safe-card\" v-if=\"order.status === 8 || order.status === 2\">\r\n      <text class=\"safe-title\">安全提醒</text>\r\n      <text class=\"safe-text\">请勿通过微信/QQ等站外平台私下交易。站外交易无法享受\"臻托\"资金保障。</text>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { request } from '@/utils/request'\r\nimport { useUserStore } from '@/stores/user'\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      order: {\r\n        id: 1,\r\n        orderNo: 'TF8829310',\r\n        status: 1,\r\n        statusText: '进行中',\r\n        title: '臻托平台UI原型设计',\r\n        amount: '3,500'\r\n      },\r\n      timeline: []\r\n    }\r\n  },\r\n  mounted() {\r\n    const pages = getCurrentPages()\r\n    const currentPage = pages[pages.length - 1]\r\n    const id = currentPage.options.id\r\n    if (id) {\r\n        this.order.id = id\r\n        this.loadOrderDetail(id)\r\n    }\r\n  },\r\n  onShow() {\r\n    // 每次页面显示时重新加载订单数据（从签署页面返回时会触发）\r\n    if (this.order.id) {\r\n      this.loadOrderDetail(this.order.id)\r\n    }\r\n  },\r\n  methods: {\r\n    async loadOrderDetail(id) {\r\n        try {\r\n            const res = await request({\r\n                url: `/order/${id}`,\r\n                method: 'GET'\r\n            })\r\n            if (res.data) {\r\n                const data = res.data\r\n                this.order = {\r\n                    id: data.order.id,\r\n                    orderNo: data.order.orderNo,\r\n                    status: data.order.status,\r\n                    statusText: this.getStatusText(data.order.status),\r\n                    title: data.order.title,\r\n                    amount: this.formatCurrency(data.order.totalAmount),\r\n                    role: this.getUserRole(data.order)\r\n                }\r\n                \r\n                this.buildTimeline(data)\r\n            }\r\n        } catch (e) {\r\n            console.error(e)\r\n            uni.showToast({ title: '加载失败', icon: 'none' })\r\n        }\r\n    },\r\n    getUserRole(order) {\r\n        const uid = useUserStore().userInfo.id\r\n        if (order.buyerId === uid) return 'buyer'\r\n        if (order.sellerId === uid) return 'seller'\r\n        return 'visitor'\r\n    },\r\n    buildTimeline(data) {\r\n        const list = []\r\n        const order = data.order\r\n        \r\n        // 1. 资金托管/发布\r\n        list.push({\r\n            title: '资金已托管',\r\n            desc: this.formatDate(order.createTime),\r\n            done: true,\r\n            active: false\r\n        })\r\n        \r\n        // 2. 商家接单\r\n        if (order.status >= 8 && order.sellerId) { // 8-待签约及后续\r\n             list.push({\r\n                title: '商家已接单',\r\n                desc: '服务商已确认接单',\r\n                done: true,\r\n                active: false\r\n            })\r\n        }\r\n        \r\n        // 3. 待签署合同 (status = 8)\r\n        if (order.status === 8) {\r\n            // 检查是否已有合同\r\n            const hasContract = data.contract && data.contract.id\r\n            \r\n            if (!hasContract && this.order.role === 'seller') {\r\n                // 商家需要先创建合同\r\n                list.push({\r\n                    title: '创建项目合同',\r\n                    desc: '请创建并提交项目合同',\r\n                    done: false,\r\n                    active: true,\r\n                    actions: ['创建合同'],\r\n                    orderId: order.id\r\n                })\r\n            } else if (hasContract) {\r\n                // 合同已创建，等待签署\r\n                const contractStatus = data.contract.status\r\n                // 0-草稿 1-待甲方签署 2-待乙方签署 3-已生效\r\n                \r\n                if (contractStatus === 1 && this.order.role === 'buyer') {\r\n                    list.push({\r\n                        title: '待您签署合同',\r\n                        desc: '商家已创建合同，请查看并签署',\r\n                        done: false,\r\n                        active: true,\r\n                        actions: ['查看并签署'],\r\n                        orderId: order.id,\r\n                        contractId: data.contract.id\r\n                    })\r\n                } else if (contractStatus === 2 && this.order.role === 'seller') {\r\n                    list.push({\r\n                        title: '待您签署合同',\r\n                        desc: '买家已签署，请您签署确认',\r\n                        done: false,\r\n                        active: true,\r\n                        actions: ['查看并签署'],\r\n                        orderId: order.id,\r\n                        contractId: data.contract.id\r\n                    })\r\n                } else if (contractStatus === 1 && this.order.role === 'seller') {\r\n                    list.push({\r\n                        title: '等待买家签署',\r\n                        desc: '合同已提交，等待买家签署',\r\n                        done: false,\r\n                        active: true\r\n                    })\r\n                } else if (contractStatus === 2 && this.order.role === 'buyer') {\r\n                    list.push({\r\n                        title: '等待商家签署',\r\n                        desc: '您已签署，等待商家签署',\r\n                        done: false,\r\n                        active: true\r\n                    })\r\n                }\r\n            } else if (this.order.role === 'buyer') {\r\n                // 买家等待商家创建合同\r\n                list.push({\r\n                    title: '等待商家创建合同',\r\n                    desc: '商家正在准备项目合同',\r\n                    done: false,\r\n                    active: true\r\n                })\r\n            }\r\n        }\r\n        \r\n        // 4. 阶段信息 (status >= 2)\r\n        if (order.status >= 2 && data.stages && data.stages.length > 0) {\r\n            data.stages.forEach(stage => {\r\n                list.push({\r\n                    title: stage.stageName,\r\n                    desc: stage.status === 1 ? '进行中' : (stage.status >= 2 ? '已完成' : '待开始'),\r\n                    done: stage.status >= 2, // 2-Delivered, 3-Completed\r\n                    active: stage.status === 1, // 1-Processing\r\n                    actions: this.getStageActions(stage, this.order.role),\r\n                    stageId: stage.id,\r\n                    orderId: order.id\r\n                })\r\n            })\r\n        }\r\n        \r\n        // 5. 验收完成\r\n        if (order.status === 4) { // 4-Completed\r\n             list.push({\r\n                title: '订单完成',\r\n                desc: this.formatDate(order.updateTime),\r\n                done: true,\r\n                active: true\r\n            })\r\n        }\r\n        \r\n        this.timeline = list\r\n    },\r\n    getStageActions(stage, role) {\r\n        // 根据角色和阶段状态返回操作\r\n        // stage status: 0-Pending, 1-Processing, 2-Delivery(Wait Accept), 3-Completed, 4-Escrowed(Wait Start)\r\n        if (role === 'buyer' && stage.status === 2) { // 待验收状态\r\n            return ['确认验收', '拒绝验收']\r\n        }\r\n        if (role === 'seller' && (stage.status === 1 || stage.status === 0 || stage.status === 4)) {\r\n            // 这里简化逻辑，实际需要看具体业务允许何时提交\r\n            if (stage.status === 1 || stage.status === 4) return ['提交交付']\r\n        }\r\n        return []\r\n    },\r\n    getStatusText(status) {\r\n      const map = { \r\n        0: '待接单', 8: '待签约', 1: '待托管', \r\n        2: '进行中', 3: '待验收', 9: '质保中', \r\n        4: '已完成', 5: '已取消', 6: '纠纷中' \r\n      }\r\n      return map[status] || '未知'\r\n    },\r\n    formatCurrency(value) {\r\n      if (!value) return '0.00'\r\n      return parseFloat(value).toLocaleString('zh-CN', { minimumFractionDigits: 0, maximumFractionDigits: 0 })\r\n    },\r\n    formatDate(dateStr) {\r\n      if (!dateStr) return ''\r\n      return dateStr.substring(0, 16).replace('T', ' ')\r\n    },\r\n    goBack() {\r\n      uni.navigateBack()\r\n    },\r\n    async handleAction(action, step) {\r\n      const orderId = this.order.id\r\n      \r\n      if (action === '创建合同') {\r\n          // 跳转到合同创建页面\r\n          uni.navigateTo({ \r\n              url: `/pages/user/contract-edit?orderId=${orderId}` \r\n          })\r\n          return\r\n      }\r\n      \r\n      if (action === '查看并签署') {\r\n          // 跳转到合同签署页面\r\n          const contractId = step.contractId\r\n          if (!contractId) {\r\n              uni.showToast({ title: '合同ID缺失', icon: 'none' })\r\n              return\r\n          }\r\n          uni.navigateTo({ \r\n              url: `/pages/user/contract-sign?orderId=${orderId}&contractId=${contractId}` \r\n          })\r\n          return\r\n      }\r\n      \r\n      if (action === '签署合同') {\r\n          uni.showModal({\r\n              title: '签署合同',\r\n              content: '请确认您已阅读并同意合同条款。签署后将进入项目执行阶段。',\r\n              confirmText: '确认签署',\r\n              success: async (res) => {\r\n                  if (res.confirm) {\r\n                      uni.showLoading({ title: '签署中...' })\r\n                      try {\r\n                          // 1. 先获取订单对应的合同ID\r\n                          const contractRes = await request({\r\n                              url: `/contract/order/${orderId}`,\r\n                              method: 'GET'\r\n                          })\r\n                          \r\n                          if (!contractRes.data || !contractRes.data.id) {\r\n                              throw new Error('合同不存在，请联系客服')\r\n                          }\r\n                          \r\n                          const contractId = contractRes.data.id\r\n                          \r\n                          // 2. 签署合同\r\n                          await request({\r\n                              url: `/contract/${contractId}/sign`,\r\n                              method: 'POST',\r\n                              data: {\r\n                                  signature: 'merchant_signature' // 商家签名\r\n                              }\r\n                          })\r\n                          \r\n                          uni.hideLoading()\r\n                          uni.showToast({ title: '签署成功', icon: 'success' })\r\n                          \r\n                          // 3. 重新加载订单详情\r\n                          setTimeout(() => {\r\n                              this.loadOrderDetail(orderId)\r\n                          }, 1500)\r\n                      } catch (e) {\r\n                          uni.hideLoading()\r\n                          uni.showModal({\r\n                              title: '签署失败',\r\n                              content: e.message || '签署失败，请稍后重试',\r\n                              showCancel: false\r\n                          })\r\n                      }\r\n                  }\r\n              }\r\n          })\r\n          return\r\n      }\r\n      \r\n      if (!step || !step.stageId) return\r\n      \r\n      const stageId = step.stageId\r\n      \r\n      if (action === '提交交付') {\r\n          uni.showModal({\r\n              title: '提交交付',\r\n              content: '确认提交当前阶段成果？',\r\n              editable: true,\r\n              placeholderText: '请输入成果描述或链接',\r\n              success: async (res) => {\r\n                  if (res.confirm) {\r\n                      try {\r\n                          await request({\r\n                              url: `/order/${orderId}/stage/${stageId}/deliver`,\r\n                              method: 'POST',\r\n                              data: {\r\n                                  evidenceUrl: 'https://oss.trust.com/demo.zip',\r\n                                  deliveryDesc: res.content || '已完成阶段工作，请查收'\r\n                              }\r\n                          })\r\n                          uni.showToast({ title: '提交成功' })\r\n                          this.loadOrderDetail(orderId)\r\n                      } catch (e) {\r\n                          uni.showToast({ title: e.message, icon: 'none' })\r\n                      }\r\n                  }\r\n              }\r\n          })\r\n      } else if (action === '确认验收') {\r\n          uni.showModal({\r\n              title: '确认验收',\r\n              content: '确认验收通过该阶段成果？资金将释放给商家。',\r\n              success: async (res) => {\r\n                  if (res.confirm) {\r\n                      try {\r\n                          await request({\r\n                              url: `/order/${orderId}/stage/${stageId}/accept`,\r\n                              method: 'POST'\r\n                          })\r\n                          uni.showToast({ title: '验收成功' })\r\n                          this.loadOrderDetail(orderId)\r\n                      } catch (e) {\r\n                          uni.showToast({ title: e.message, icon: 'none' })\r\n                      }\r\n                  }\r\n              }\r\n          })\r\n      } else if (action === '拒绝验收') {\r\n          uni.showModal({\r\n              title: '拒绝验收',\r\n              content: '请输入拒绝原因',\r\n              editable: true,\r\n              placeholderText: '原因',\r\n              success: async (res) => {\r\n                  if (res.confirm) {\r\n                      try {\r\n                          await request({\r\n                              url: `/order/${orderId}/stage/${stageId}/reject`,\r\n                              method: 'POST',\r\n                              data: { reason: res.content || '成果不符合要求' }\r\n                          })\r\n                          uni.showToast({ title: '已拒绝' })\r\n                          this.loadOrderDetail(orderId)\r\n                      } catch (e) {\r\n                          uni.showToast({ title: e.message, icon: 'none' })\r\n                      }\r\n                  }\r\n              }\r\n          })\r\n      } else {\r\n          uni.showToast({ title: action, icon: 'none' })\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.page {\r\n  min-height: 100vh;\r\n  background: #f0f4f8;\r\n  padding-bottom: 32rpx;\r\n}\r\n\r\n.nav-bar {\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 24rpx 32rpx;\r\n  padding-top: calc(24rpx + env(safe-area-inset-top));\r\n  background: #fff;\r\n}\r\n\r\n.back-btn {\r\n  width: 80rpx;\r\n  height: 80rpx;\r\n  background: #f5f5f5;\r\n  border-radius: 50%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  font-size: 36rpx;\r\n  color: #666;\r\n}\r\n\r\n.nav-title {\r\n  flex: 1;\r\n  text-align: center;\r\n  font-size: 36rpx;\r\n  font-weight: 600;\r\n  margin-right: 80rpx;\r\n}\r\n\r\n.status-card {\r\n  margin: 24rpx 32rpx;\r\n  background: #fff;\r\n  border-radius: 48rpx;\r\n  padding: 40rpx;\r\n  box-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.status-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 48rpx;\r\n}\r\n\r\n.status-badge {\r\n  font-size: 24rpx;\r\n  font-weight: 600;\r\n  padding: 12rpx 24rpx;\r\n  background: rgba(34, 197, 94, 0.1);\r\n  color: #22c55e;\r\n  border-radius: 20rpx;\r\n}\r\n\r\n.order-no {\r\n  font-size: 24rpx;\r\n  color: #999;\r\n}\r\n\r\n.timeline {\r\n  position: relative;\r\n  padding-left: 48rpx;\r\n}\r\n\r\n.timeline-line {\r\n  position: absolute;\r\n  left: 12rpx;\r\n  top: 16rpx;\r\n  bottom: 16rpx;\r\n  width: 4rpx;\r\n  background: #eee;\r\n}\r\n\r\n.timeline-item {\r\n  position: relative;\r\n  padding-bottom: 48rpx;\r\n  \r\n  &:last-child {\r\n    padding-bottom: 0;\r\n  }\r\n}\r\n\r\n.timeline-dot {\r\n  position: absolute;\r\n  left: -42rpx;\r\n  top: 8rpx;\r\n  width: 24rpx;\r\n  height: 24rpx;\r\n  border-radius: 50%;\r\n  background: #ddd;\r\n  \r\n  &.done {\r\n    background: #22c55e;\r\n    box-shadow: 0 0 0 8rpx rgba(34, 197, 94, 0.2);\r\n  }\r\n  \r\n  &.active {\r\n    background: #00AFE1;\r\n    box-shadow: 0 0 0 8rpx rgba(0, 175, 225, 0.2);\r\n  }\r\n}\r\n\r\n.timeline-content {\r\n  padding-left: 16rpx;\r\n}\r\n\r\n.timeline-title {\r\n  font-size: 30rpx;\r\n  font-weight: 600;\r\n  color: #999;\r\n  display: block;\r\n  \r\n  &.active {\r\n    color: #00AFE1;\r\n  }\r\n}\r\n\r\n.timeline-desc {\r\n  font-size: 24rpx;\r\n  color: #999;\r\n  margin-top: 8rpx;\r\n  display: block;\r\n}\r\n\r\n.timeline-actions {\r\n  display: flex;\r\n  gap: 16rpx;\r\n  margin-top: 20rpx;\r\n}\r\n\r\n.action-btn {\r\n  font-size: 22rpx;\r\n  padding: 12rpx 24rpx;\r\n  border-radius: 16rpx;\r\n  background: #f5f5f5;\r\n  color: #666;\r\n  \r\n  &.primary {\r\n    background: #00AFE1;\r\n    color: #fff;\r\n  }\r\n}\r\n\r\n.safe-card {\r\n  margin: 24rpx 32rpx;\r\n  background: linear-gradient(135deg, #00AFE1 0%, #0084A8 100%);\r\n  border-radius: 48rpx;\r\n  padding: 40rpx;\r\n}\r\n\r\n.safe-title {\r\n  font-size: 32rpx;\r\n  font-weight: 600;\r\n  color: #fff;\r\n  display: block;\r\n  margin-bottom: 16rpx;\r\n}\r\n\r\n.safe-text {\r\n  font-size: 26rpx;\r\n  color: rgba(255, 255, 255, 0.8);\r\n  line-height: 1.6;\r\n}\r\n</style>\r\n","import mod from \"-!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./detail.vue?vue&type=style&index=0&id=57d42baa&lang=scss&scoped=true&\"; export default mod; export * from \"-!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!A:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./detail.vue?vue&type=style&index=0&id=57d42baa&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1770381686780\n      var cssReload = require(\"A:/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}